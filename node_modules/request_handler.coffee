# :mode=coffeescript:indentSize=2:noTabs=true:tabSize=2:
# request handler registry

path=require 'path'
fs=require 'fs'
url=require 'url'
util=require 'util'

handlers=
  'static':require './request_handlers/static'

exports.get=(name) ->
  throw new Error('Unknown request handler '+name) unless handlers[name]?
  return handlers[name]

default_handler=(req,res) ->
  res.writeHead 404,'Content-Type':'text/plain'
  res.end 'Unknown request '+req.url

exports.handle=(req,res) ->
  console.log 'Request: '+req.method+' '+req.url
  (handlers[(url.parse req.url).pathname] ? default_handler).handle(req,res)

exports.set_default=(name) ->
  default_handler=exports.get name

exports.forward=(pathname,handler) ->
  handlers[pathname]=exports.get handler

exports.handle_with=(handler,req,res) ->
  (exports.get handler).handle(req,res)

