# helper functions for writing responses

util=require 'util'

log=require 'log'

exports.content=(req,res,content,mime,content_len) ->
  len=content_len
  unless content_len?
    if typeof content == 'string'
      len=Buffer.byteLength content
    else
      len=content.length
  res.writeHead 200,
    'Content-Type':mime
    'Content-Length':len
  res.end content

exports.json=(req,res,obj) ->
  s=JSON.stringify obj
  res.writeHead 200,
    'Content-Type':'application/json'
    'Content-Length':Buffer.byteLength s
  res.end s

exports.error=(req,res,e=null,text='Internal Server Error',code=500) ->
  s=''
  s=util.inspect e if e?
  log.error code+' '+text+' on '+req.method+' '+req.url+'\n'+s

  res.writeHead code,text,
    'Content-Type':'text/plain'
    'Content-Length':Buffer.byteLength text
  res.end text

exports.not_found=(req,res,text) ->
  exports.error req,res,text,'Not Found',404
exports.bad_request=(req,res,text) ->
  exports.error req,res,text,'Bad Request',400
exports.unauthorized=(req,res,text) ->
  exports.error req,res,text,'Unauthorized',401
exports.not_implemented=(req,res,text) ->
  exports.error req,res,text,'Not Implemented',501

